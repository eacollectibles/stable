<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TESTING VERSION – Buyback Portal</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select, button { margin: 5px; padding: 8px; font-size: 14px; }
    .card-row { margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
    .remove-btn { background: red; color: white; border: none; padding: 6px 10px; cursor: pointer; }
    #trade-result { margin-top: 20px; font-size: 16px; }
  </style>
</head>
<body>
  <div style="background: #ffd700; color: #000; text-align: center; font-weight: bold; padding: 10px;">
    TESTING VERSION ACTIVE
  </div>

  <h2>Trade-In Cards</h2>
  <form id="trade-form">
    <label for="employeeName"><strong>Employee:</strong></label>
    <select name="employeeName" id="employeeName" required style="margin-bottom: 10px;">
      <option value="" disabled selected>Select Employee</option>
      <option value="Alex">Alex</option>
      <option value="Jamie">Jamie</option>
      <option value="Morgan">Morgan</option>
      <option value="Taylor">Taylor</option>
    </select><br>
    <div id="card-list">
      <div class="card-row">
        <input type="text" name="cardName" placeholder="Card Name" required />
        <input type="number" name="cardQty" placeholder="Qty" min="1" value="1" required />
        <select name="cardCondition" required>
          <option value="NM">NM</option>
          <option value="LP">LP</option>
          <option value="MP">MP</option>
        </select>
        <button type="button" class="remove-btn" onclick="this.parentElement.remove()">✖</button>
      </div>
    </div>
    <button type="button" id="add-card">➕ Add Card</button>
    <button type="submit" id="submit-trade">Submit Trade</button>
  </form>

  
        <div id="status-bar" style="margin-top: 15px; padding: 10px; display: none;"></div>
        <div id="trade-log" style="margin-top: 20px;">
          <h3>Trade Log</h3>
          <div id="log-entries"></div>
        </div>
        <div id="trade-result">
        </div>

  

<script>
document.addEventListener('DOMContentLoaded', function () {
  const cardList = document.getElementById('card-list');
  const tradeLog = document.getElementById('log-entries');
  const statusBar = document.getElementById('status-bar');

  document.getElementById('add-card').addEventListener('click', function () {
    const row = document.createElement('div');
    row.className = 'card-row';
    row.innerHTML = `
      <div style="display: flex; flex-direction: column; position: relative;">
        <div style="display: flex; align-items: center; gap: 5px;">
          <input type="text" name="cardName" placeholder="Card Name" required />
          <button type="button" class="search-icon" title="Search">&#128269;</button>
        </div>
        <div class="autocomplete-results" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ccc; z-index: 10;"></div>
      </div>
      <input type="number" name="cardQty" placeholder="Qty" min="1" value="1" required />
      <select name="cardCondition" required>
        <option value="NM">NM</option>
        <option value="LP">LP</option>
        <option value="MP">MP</option>
      </select>
      <button type="button" class="remove-btn" onclick="this.parentElement.remove()">✖</button>
    `;
    cardList.appendChild(row);

    const input = row.querySelector('input[name="cardName"]');
    const button = row.querySelector('.search-icon');
    const resultsDiv = row.querySelector('.autocomplete-results');

    button.addEventListener('click', () => {
      const query = input.value.trim();
      if (query.length < 2) {
        resultsDiv.innerHTML = '<div>Enter 2+ characters</div>';
        return;
      }

      fetch(\`/api/searchProducts?q=\${encodeURIComponent(query)}\`)
        .then(res => res.json())
        .then(data => {
          resultsDiv.innerHTML = '';
          if (!Array.isArray(data)) {
            resultsDiv.innerHTML = "<div>No results or API error.</div>";
            return;
          }
          data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'result-item';
            div.innerText = \`\${item.title} (\${item.sku}) - $\${item.price}\`;
            div.style.padding = '5px';
            div.style.cursor = 'pointer';
            div.style.borderBottom = '1px solid #eee';
            div.addEventListener('click', () => {
              input.value = item.title;
              resultsDiv.innerHTML = '';
            });
            resultsDiv.appendChild(div);
          });
        })
        .catch(err => {
          console.error("Fetch error:", err);
          resultsDiv.innerHTML = "<div>Search failed</div>";
        });
    });

    document.addEventListener('click', function (e) {
      if (!resultsDiv.contains(e.target) && e.target !== button && e.target !== input) {
        resultsDiv.innerHTML = '';
      }
    });
  });
});
</script>



<script>
document.addEventListener('DOMContentLoaded', function () {
  const cardList = document.getElementById('card-list');
  const tradeLog = document.getElementById('log-entries');
  const statusBar = document.getElementById('status-bar');

  document.getElementById('add-card').addEventListener('click', function () {
    const row = document.createElement('div');
    row.className = 'card-row';
    row.innerHTML = `
      <div style="display: flex; flex-direction: column; position: relative;">
        <div style="display: flex; align-items: center; gap: 5px;">
          <input type="text" name="cardName" placeholder="Card Name" required />
          <button type="button" class="search-icon" title="Search">&#128269;</button>
        </div>
        <div class="autocomplete-results" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ccc; z-index: 10;"></div>
      </div>
      <input type="number" name="cardQty" placeholder="Qty" min="1" value="1" required />
      <select name="cardCondition" required>
        <option value="NM">NM</option>
        <option value="LP">LP</option>
        <option value="MP">MP</option>
      </select>
      <button type="button" class="remove-btn" onclick="this.parentElement.remove()">✖</button>
    `;
    cardList.appendChild(row);

    const input = row.querySelector('input[name="cardName"]');
    const button = row.querySelector('.search-icon');
    const resultsDiv = row.querySelector('.autocomplete-results');

    button.addEventListener('click', () => {
      const query = input.value.trim();
      if (query.length < 2) {
        resultsDiv.innerHTML = '<div>Enter 2+ characters</div>';
        return;
      }

      fetch(\`/api/searchProducts?q=\${encodeURIComponent(query)}\`)
        .then(res => res.json())
        .then(data => {
          resultsDiv.innerHTML = '';
          if (!Array.isArray(data)) {
            resultsDiv.innerHTML = "<div>No results or API error.</div>";
            return;
          }
          data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'result-item';
            div.innerText = \`\${item.title} (\${item.sku}) - $\${item.price}\`;
            div.style.padding = '5px';
            div.style.cursor = 'pointer';
            div.style.borderBottom = '1px solid #eee';
            div.addEventListener('click', () => {
              input.value = item.title;
              resultsDiv.innerHTML = '';
            });
            resultsDiv.appendChild(div);
          });
        })
        .catch(err => {
          console.error("Fetch error:", err);
          resultsDiv.innerHTML = "<div>Search failed</div>";
        });
    });

    document.addEventListener('click', function (e) {
      if (!resultsDiv.contains(e.target) && e.target !== button && e.target !== input) {
        resultsDiv.innerHTML = '';
      }
    });
  });
});
</script>

</body>
</html>